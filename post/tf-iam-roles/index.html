<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 2.4.0">
  <meta name="generator" content="Hugo 0.49" />
  <meta name="author" content="Noel">

  
  
  
  
    
  
  <meta name="description" content="An IAM role is an AWS identity with permission policies that determine what the identity can and cannot do in AWS.
TL;DR  The principal is WHO will be able to access a resource.
 The policy is WHAT the principals associated with the role will be able to do.
 The role links the principals thanks to the assume_role_policy with the inline policy argument. The attachement links the role to a managed policies instead of the inline policy.">

  
  <link rel="alternate" hreflang="en-us" href="https://netmemo.github.io/post/tf-iam-roles/">

  


  

  

  

  
  
  
  <meta name="theme-color" content="hsl(190, 90%, 68%)">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css" crossorigin="anonymous">
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href=//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono>
  

  <link rel="stylesheet" href="/styles.css">
  

  
  
  

  
  <link rel="alternate" href="https://netmemo.github.io/index.xml" type="application/rss+xml" title="netmemo.github.io">
  <link rel="feed" href="https://netmemo.github.io/index.xml" type="application/rss+xml" title="netmemo.github.io">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://netmemo.github.io/post/tf-iam-roles/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="netmemo.github.io">
  <meta property="og:url" content="https://netmemo.github.io/post/tf-iam-roles/">
  <meta property="og:title" content="AWS IAM Roles with Terraform | netmemo.github.io">
  <meta property="og:description" content="An IAM role is an AWS identity with permission policies that determine what the identity can and cannot do in AWS.
TL;DR  The principal is WHO will be able to access a resource.
 The policy is WHAT the principals associated with the role will be able to do.
 The role links the principals thanks to the assume_role_policy with the inline policy argument. The attachement links the role to a managed policies instead of the inline policy.">
  
  
    
  <meta property="og:image" content="https://netmemo.github.io/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2021-09-27T18:04:31&#43;02:00">
  
  <meta property="article:modified_time" content="2021-09-27T18:04:31&#43;02:00">
  

  

  

  <title>AWS IAM Roles with Terraform | netmemo.github.io</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" class="dark">

<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">netmemo.github.io</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#hero">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>About</span>
            
          </a>
        </li>

        
        

      

        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  





  <div class="article-container">
    <h1 itemprop="name">AWS IAM Roles with Terraform</h1>

    

<div class="article-metadata">

  
  
  
  <div>
    
    <span itemscope itemprop="author" itemtype="http://schema.org/Person">
      <span itemprop="name">Noel</span>
    </span>
    
  </div>
  

  <span class="article-date">
    
    <meta content="2021-09-27 18:04:31 &#43;0200 CEST" itemprop="datePublished">
    <time datetime="2021-09-27 18:04:31 &#43;0200 CEST" itemprop="dateModified">
      Sep 27, 2021
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Noel">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    3 min read
  </span>
  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/categories/iac/">IAC</a>, 
    
    <a href="/categories/cloud/">CLOUD</a>, 
    
    <a href="/categories/aws/">AWS</a>
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=AWS%20IAM%20Roles%20with%20Terraform&amp;url=https%3a%2f%2fnetmemo.github.io%2fpost%2ftf-iam-roles%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fnetmemo.github.io%2fpost%2ftf-iam-roles%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fnetmemo.github.io%2fpost%2ftf-iam-roles%2f&amp;title=AWS%20IAM%20Roles%20with%20Terraform"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2fnetmemo.github.io%2fpost%2ftf-iam-roles%2f&amp;title=AWS%20IAM%20Roles%20with%20Terraform"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=AWS%20IAM%20Roles%20with%20Terraform&amp;body=https%3a%2f%2fnetmemo.github.io%2fpost%2ftf-iam-roles%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      

<p>An IAM role is an AWS identity with permission policies that determine what the identity can and cannot do in AWS.</p>

<h1 id="tl-dr">TL;DR</h1>

<ul>
<li>The <strong><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_principal.html" target="_blank">principal</a></strong> is <strong>WHO</strong> will be able to access a resource.<br /></li>
<li>The <strong>policy</strong> is <strong>WHAT</strong> the principals associated with the role will be able to do.<br /></li>
<li>The <strong>role</strong> links the principals thanks to the <em>assume_role_policy</em> with the <em>inline policy</em> argument.</li>
<li>The <strong>attachement</strong> links the role to a <em>managed policies</em> instead of the <em>inline policy</em>.</li>
</ul>

<p><a href="aws-iam-simple.png" target="_blank"> <img src="aws-iam-simple.png" alt="" /> </a></p>

<h1 id="terraform-resources-and-aws-api">Terraform resources and AWS API</h1>

<h3 id="policy">Policy</h3>

<p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_policy" target="_blank">aws_iam_policy</a> | <a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html" target="_blank">aws create policy API</a><br />
There are 3 types of policies.</p>

<ul>
<li>Inline :  The policy is defined directly in the object that needs it.</li>
<li>Managed : More flexible, can be reused with several roles. Need to be attached with an object.</li>
<li>AWS Managed : Same advantages as the managed ones but can&rsquo;t be modified.</li>
</ul>

<p>Here is a link that helps to <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_managed-vs-inline.html#choosing-managed-or-inline" target="_blank">choose</a> between them.</p>

<h3 id="role">Role</h3>

<p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role" target="_blank">aws_iam_role</a> | <a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateRole.html" target="_blank">aws create role API</a></p>

<p>This is to define the IAM role resource that will link the principals and the policy.<br />
If we are using <em>managed policy</em> we will need to link this role to the <em>managed policy</em> with an attachment resource. In case of using <em>inline policy</em>, the <em>inline policy</em> is declared in the Terraform resource role. With AWS API, it needs <a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html" target="_blank">another API call</a> to set the <em>inline policy</em> in the <em>role</em>.</p>

<blockquote>
<p><strong>assume_role_policy</strong><br />
This is a mandatory argument used in aws_iam_role and aws_iam_role_policy to indicate <strong>WHO</strong> can temporarily assume the role that we are defining. It&rsquo;s also referred as trust policy.<br />
<a href="https://stackoverflow.com/questions/44628380/terraform-assume-role-policy-similar-but-slightly-different-than-standard-ia" target="_blank">explanation 1</a>, <a href="https://aws.amazon.com/blogs/security/how-to-use-trust-policies-with-iam-roles/" target="_blank">explanation 2</a></p>
</blockquote>

<h3 id="attachments">Attachments</h3>

<p>Attach a <em>managed policy</em> to a group, user or role</p>

<ul>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_group_policy_attachment" target="_blank">aws_iam_group_policy_attachment</a> | <a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html" target="_blank">aws attach group policy API</a></li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_user_policy_attachment" target="_blank">aws_iam_user_policy_attachment</a> | <a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html" target="_blank">aws attach user policy API</a><br /></li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment" target="_blank">aws_iam_role_policy_attachment</a> | <a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html" target="_blank">aws attach role policy API</a><br /></li>
</ul>

<h1 id="possibilities-of-policy-attachment">Possibilities of policy attachment</h1>

<p>From the less flexible to the most flexible:</p>

<ul>
<li>1 resource: aws_iam_role with <em>inline_policy</em> argument<br /></li>
<li>2 resources: aws_iam_role + aws_iam_role_policy (conflict with aws_iam_role / inline_policy)<br /></li>
<li>3 resources: aws_iam_role + aws_iam_policy + aws_iam_role_policy_attachment<br /></li>
</ul>

<h1 id="terraform-specific-resources">Terraform specific resources</h1>

<h3 id="datasource">Datasource</h3>

<p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document" target="_blank">aws_iam_policy_document</a>.
This is an optional datasource which is Terraform specific. The policy defined in HCL format is translated to JSON when associated with the inline policy attribute of the role.
The advantages of using this <a href="https://learn.hashicorp.com/tutorials/terraform/aws-iam-policy?_ga=2.99142555.466421101.1630266824-70591653.1623679226" target="_blank">Policy in HCL format</a> are:</p>

<ul>
<li>Being able to overwrite, append, or update policies with this resource by using the source_json and override_json arguments.</li>
<li>Terraform error checking automatically formats your policy document into correct JSON when you run your apply.<br /></li>
<li>Data sources make it easier to reuse policies throughout your environment.</li>
</ul>

<p>It can be used in the below resources.</p>

<ul>
<li>aws_iam_policy / <em>policy</em> argument<br /></li>
<li>aws_iam_role_policy / <em>policy</em> argument<br /></li>
<li>aws_iam_role_policy / <em>assume_role_policy</em> argument</li>
<li>aws_iam_role / <em>assume_role_policy</em> argument</li>
</ul>

<h3 id="inline-policy-resources">Inline policy resources</h3>

<p>Provide an IAM user/role/group with an inline policy.
These resources are made to reduce the number of objects for a user. You can directly use them instead of creating an user, the policy and the attachement to link both (2 vs 3 resources).
There is an <strong>overlap</strong> between the <em>aws_iam_role_policy</em> and the <em>aws_iam_role</em> / <em>inline_policy</em> argument. There are incompatible.</p>

<ul>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_user_policy" target="_blank">aws_iam_user_policy</a></li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy" target="_blank">aws_iam_role_policy</a></li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_group_policy" target="_blank">aws_iam_group_policy</a><br /></li>
</ul>

<h3 id="attachment">Attachment</h3>

<p>There are lots of <strong>overlap</strong>, <strong>incompatibility</strong> and <strong>conflict</strong> with this resource.</p>

<ul>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_policy_attachment" target="_blank">aws_iam_policy_attachment</a> EXCLUSIVE with other attachements.<br /></li>
</ul>

<blockquote>
<p>conflict with aws_iam_user_policy_attachment, aws_iam_group_policy_attachment, aws_iam_role_policy_attachment</p>
</blockquote>

<h3 id="bonus">Bonus :)</h3>

<p>As a bonus here are the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_iam-quotas.html" target="_blank">quotas</a> for IAM and STS</p>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/aws/">AWS</a>
  
  <a class="badge badge-light" href="/tags/iam/">IAM</a>
  
  <a class="badge badge-light" href="/tags/terraform/">Terraform</a>
  
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Related</h3>
      <ul>
        
        <li><a href="/post/tf-for-each/">Using Terraform for_each to create subnets in AWS VPC</a></li>
        
        <li><a href="/post/nsxt-tf-firewall/">NSX-T Firewall rules as code with Terraform</a></li>
        
        <li><a href="/post/terraform-refactoring-state-file/">Terraform Refactoring State File</a></li>
        
        <li><a href="/post/tf-nsxt-nested-for-each/">Terraform nested for_each for NSX-T with dynamic</a></li>
        
        <li><a href="/post/tf-bundle-windows/">Create portable Terraform and plugins with Terraform-bundle for Windows</a></li>
        
      </ul>
    </div>
    

    

    <script src="https://utteranc.es/client.js"
        repo="netmemo/netmemo.github.io"
        issue-term="pathname"
        label="blogcomment"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    No&euml;l Boul&egrave;ne &copy; 2021. This blog is strictly personnal and opinions expressed here are only mine and doesn&#39;t reflect those of my past, current or futur employers. No warranty whatsoever is made that any of the posts are accurate. There is absolutely no assurance (apart from author&acute;s professional integrity) that any statement contained in a post is true, correct or precise. &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
    

    <script src="/js/hugo-academic.js"></script>
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "Search Results",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    <script src="/js/search.js"></script>
    

    
    

  </body>
</html>

